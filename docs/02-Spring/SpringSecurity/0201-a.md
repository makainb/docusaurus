---
draft: true
sidebar_class_name: hidden-sidebar-item
---

## 自定义用户查询

UserDetailsService#loadUserByUsername

## 自定义用户对象

```java
public interface UserDetails extends Serializable {

    Collection<? extends GrantedAuthority> getAuthorities();//获取所有权限

    String getPassword();// 获取密码

    String getUsername();//获取用户名

    boolean isAccountNonExpired(); //账号是否过期

    boolean isAccountNonLocked();// 账号是否被锁定

    boolean isCredentialsNonExpired()// 凭证（密码）是否过期

    boolean isEnabled(); // 是否启用
}
```

## 如果没有找到用户
```
UsernameNotFoundException
```

## 密码加密
```java
@Bean
public PasswordEncoder passwordEncoder() {
    // return new BCryptPasswordEncoder();
    return PasswordEncoderFactories.createDelegatingPasswordEncoder();
}
```

## 自定义成功信息
从AuthenticationSuccessHandler接口继承
```java
http.formLogin(form -> {
    form.successHandler(new MyAuthenticationSuccessHandler());
})
```

## 自定义失败信息
从AuthenticationFailureHandler接口继承
```java
http.formLogin(form -> {
    form.failureHandler(new MyAuthenticationFailureHandler());
})
```

## 用户退出处理
```java
从LogoutSuccessHandler接口继承
http.logout(logout -> 
    logout.logoutSuccessHandler(new MyLogoutSuccessHandler());
);
```

## 没有认证处理
从AuthenticationEntryPoint接口继承
```java
http.exceptionHandling(exception -> 
    exception.authenticationEntryPoint(new MyAuthenticationEntryPoint());
)
```

## 自定义login登录
```java
UsernamePasswordAuthenticationToken authenticationToken = UsernamePasswordAuthenticationToken.unauthenticated(username, password);
Authentication authentication = authenticationManagerBuilder.getObject().authenticate(authenticationToken);
if(authentication == null || !authentication.isAuthenticated()){
    throw new BadCredentialsException("用户名或密码错误");   
}
// 保存用户信息
SecurityContextHolder.getContext().setAuthentication(authentication);

```
